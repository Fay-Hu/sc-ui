"use strict";Component({properties:{ripple:{type:Boolean,value:!0},tabList:{type:Array},tabIndex:{type:Number,value:0}},data:{currentTab:0,touchMoveStartX:0,touchMoveEndX:0,btnMinWidth:88,scrollLeft:0,scroll:0,scrollViewWidth:0,moveLength:64,allTabItem:[]},relations:{"../scTab/sc-tab":{type:"child"}},ready:function(){var t=this;this._queryMultipleNodes("#sc-tab").then(function(a){t.data.scrollViewWidth=a[0].width,t._queryAllNodes(".tab-bar-item").then(function(a){var e=t.data.allTabItem=a;t.data.tabStartPosition=e[0].left,t.data.tabEndPosition=e[e.length-1].right,t.data.tabListWinth=t.data.tabEndPosition-t.data.tabStartPosition,t.data.tabs=t._getAllTab(),t._setTab(t.properties.tabIndex||0)})})},methods:{_queryMultipleNodes:function(t){var a=this;return new Promise(function(e,i){var s=a.createSelectorQuery();s.select(t).boundingClientRect(),s.selectViewport().scrollOffset(),s.exec(function(t){e(t)})})},_queryAllNodes:function(t){var a=this;return new Promise(function(e,i){var s=a.createSelectorQuery();s.selectAll(t).boundingClientRect(),s.exec(function(t){e(t[0])})})},_tabBarTap:function(t){var a=t.target.dataset.idx;this.data.currentTab!==a&&this._setTab(a)},_setTab:function(t){var a=this.data.scrollViewWidth;this.setData({currentTab:t}),a<this.data.tabListWinth&&this._setScroll(t),this._setHeight(t),this.triggerEvent("tabchange",{value:t,data:this.data.tabList[t].data||{}})},_setScroll:function(t){var a=this.data,e=a.scrollLeft,i=a.scrollViewWidth,s=a.tabStartPosition,r=this.data.allTabItem[t],n=r.left,o=r.right,l=r.width;this.setData({tabDriverWidth:l,tabDriverLeft:n-s}),n>=e&&o<=Math.ceil(e+i+s)||(n<=e?this.setData({scrollLeft:0===t?0:n-s-(t>0?this.data.allTabItem[t-1].width/2:0)}):this.setData({scrollLeft:o-i-s+(t+1<this.data.tabList.length-1?this.data.allTabItem[t+1].width/2:0)}))},_setHeight:function(t){var a=this.data.tabs;setTimeout(function(){for(var e=0;e<a.length;e++)e===t?a[e].setData({tabHeight:"auto"}):a[e].setData({tabHeight:0})},150)},_touchStart:function(t){this.setData({touchMoveStartX:t.touches[0].clientX})},_touchEnd:function(t){if(1===t.changedTouches.length){var a=this.data,e=a.currentTab,i=a.moveLength,s=a.scrollViewWidth,r=a.btnMinWidth,n=this.properties.tabList.length,o=t.changedTouches[0].clientX-this.data.touchMoveStartX;if(this.setData({touchMoveEndX:0}),Math.abs(o)>i){o>=0?this.setData({currentTab:e-1>=0?e-1:0}):this.setData({currentTab:e+1<n?e+1:e});var l=this.data.currentTab;e!==l&&(s>=n*r||this._setScroll(l),this._setHeight(l),this.triggerEvent("tabchange",{value:l,data:this.data.tabList[l].data||{}}))}}},_scroll:function(t){this.data.scrollLeft=t.detail.scrollLeft},_getAllTab:function(){return this.getRelationNodes("../scTab/sc-tab")}}});