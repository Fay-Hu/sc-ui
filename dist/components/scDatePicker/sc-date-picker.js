"use strict";var moment=require("../../assets/lib/moment/moment.min"),dialogCount=0;Component({properties:{},data:{yearView:!1,dayList:[],alreadyMonth:{},yearList:[],yearRange:50,selectYear:0,selectDateObject:null,showDate:null,showDateObject:null,currentSwiperItemDateIndex:1,currentSwiperItemYearIndex:0,duration:300,lockedTap:!1,week:{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"},defaultOption:{date:new Date}},relations:{"../scDialog/sc-dialog":{type:"child"}},externalClasses:["sc-class"],ready:function(){this.setData({dialogCount:dialogCount++}),this.data.dialog=this.selectComponent("#picker-dialog-"+this.data.dialogCount)},methods:{_nextMonthDay:function(){var t=this.data.showDate.clone().add(1,"months"),e=this._monthDay(t);if(e.length>0)return e},_lastMonthDay:function(){var t=this.data.showDate.clone().add(-1,"months"),e=this._monthDay(t);if(e.length>0)return e},_monthDay:function(t){var e=moment(t),a=[],s=e.format("YYYY-MM");if(this.data.alreadyMonth[s])a=this.data.alreadyMonth[s];else{for(var n=e.year(),i=e.month(),o=e.clone().set({year:n,month:i,date:1}),r=o.day(),h=e.daysInMonth(),d=0;d<r;d++)a.push(null);for(var c=1;c<=h;c++)a.push(moment().set({year:n,month:i,date:c}).toObject());this.data.alreadyMonth[s]=a}return a},_change:function(t){var e=this,a=t.detail.current,s=this.data.showDate.add(a-this.data.currentSwiperItemDateIndex,"months");this.setData({showDate:s,showDateObject:s.toObject(),currentSwiperItemDateIndex:a}),a===this.data.dayList.length-1&&(this.setData({lockedTap:!0}),setTimeout(function(){var t=e.data.dayList;t.push(e._nextMonthDay()),e.setData({lockedTap:!1,dayList:t,currentSwiperItemDateIndex:a})},this.data.duration)),0===a&&(this.setData({lockedTap:!0}),setTimeout(function(){var t=e.data.dayList;t.unshift(e._lastMonthDay()),e.setData({lockedTap:!1,dayList:t,currentSwiperItemDateIndex:1})},this.data.duration))},_next:function(){this.data.showDate.add(1,"months"),this.setData({currentSwiperItemDateIndex:++this.data.currentSwiperItemDateIndex})},_last:function(){this.data.showDate.add(-1,"months"),this.setData({currentSwiperItemDateIndex:--this.data.currentSwiperItemDateIndex})},_selectDate:function(t){var e=t.currentTarget.dataset.date;e&&this.setData({selectDateObject:e,selectWeek:moment(e).weekday()})},_changeViewToYear:function(){this.setData({yearView:!this.data.yearView})},_selectYear:function(t){var e=t.currentTarget.dataset.year;if(e!==this.data.selectYear){var a=this.data.showDate.clone();a.set("year",e),a.set("month",a.month()),a.set("date",a.date()),this.setData({selectYear:e,selectDateObject:a.toObject(),selectWeek:a.weekday(),showDate:a,currentSwiperItemDateIndex:1,showDateObject:a.toObject()}),this.setData({dayList:[this._lastMonthDay(),this._monthDay(a.clone()),this._nextMonthDay()]})}this.setData({yearView:!1})},_open:function(t){for(var e=JSON.parse(JSON.stringify(this.data.defaultOption)),a=Object.assign(e,t),s=moment(a.date),n=s.year(),i=this.data.yearRange,o=[],r=-i;r<i;r++)o[r+i]=n+r;this.setData({selectDateObject:s.toObject(),showDate:s,showDateObject:s.toObject(),selectWeek:s.weekday(),currentSwiperItemDateIndex:1,currentSwiperItemYearIndex:i-2,yearList:o,selectYear:n}),this.setData({dayList:[this._lastMonthDay(),this._monthDay(s.clone()),this._nextMonthDay()]}),this.data.dialog._open(),this.triggerEvent("open",{})},_close:function(){this.data.dialog._close(),this.triggerEvent("close",{})},_submit:function(){this.triggerEvent("submit",{value:moment(this.data.selectDateObject).toDate()}),this._close()}}});